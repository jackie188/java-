### 搭建ODS层数据仓库

#### 日志数据

对于日志数据，我们建立一张表，表中只有一个字段，就是json格式的日志字符串。这张表也是一张分区表，每天会根据日期写入一个分区。

在这里使用的是lzo进行数据的压缩，所以上传到hdfs上面的文件，需要我们手动建立lzo索引文件，当然也可以把建立索引文件的语句写入脚本中，在导入数据的时候，直接建立索引。只要保证我们去ods层查询数据的时候，有索引即可，索引的存放位置需要和hive表放在一起。

![20211217101236](https://vscodepic.oss-cn-beijing.aliyuncs.com/pic/20211217101236.png)

上图中是存储在ods层的日志数据格式，只有一个字段line存储的是一个json字符串，后面的dt字段是分区字段。

#### 业务数据

![1639980406913](https://tprzfbucket.oss-cn-beijing.aliyuncs.com/hadoop/202112/23/183156-703941.png)

根据我们mysql业务数据库中的表结构，再hive中建立相同的表结构，然后使用sqoop讲数据导入到hive表中。

- 订单表：增量及更新，每一天会向hive表中同步增量及更新数据。
- 订单详情表：增量表，每天同步增量数据。
- sku商品表，全量表，每一天同步所有的数据。
- 用户表：增量及更新，每天同步增量及更新数据。
- 商品一级分类：全量表。
- 商品二级分类：全量表；
- 商品三级分类：全量表。
- 支付流水表：同步增量数据。
- 省份表：特殊表
- 地区表：特殊表；
- 品牌表：全量表。
- 订单状态表：增量表
- spu商品表：全量
- 商品评论表：增量表
- 退单表：增量表
- 加购表：全量表
- 商品收藏表：全量表
- 优惠券领用表：新增及变化表
- 优惠券表：全量表
- 活动表：全量表
- 活动订单关联表：增量表
- 优惠规则表：全量
- 编码字典表：全量

#### ods层日志数据和业务数据

![20211217114341](https://vscodepic.oss-cn-beijing.aliyuncs.com/pic/20211217114341.png)